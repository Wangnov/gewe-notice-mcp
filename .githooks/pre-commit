#!/bin/sh
# Git pre-commit hook - 在提交前自动运行 Rust 检查

echo "🔍 运行 pre-commit 检查..."

# 检查是否有 Rust 文件变更
if git diff --cached --name-only | grep -q '\.rs$'; then
    echo "📋 检查代码格式..."
    cargo fmt --all -- --check
    if [ $? -ne 0 ]; then
        echo "❌ 代码格式不正确，请运行 'cargo fmt' 修复"
        exit 1
    fi

    echo "🔎 运行 Clippy..."
    cargo clippy --all-targets --all-features -- -D warnings
    if [ $? -ne 0 ]; then
        echo "❌ Clippy 发现了问题，请修复后再提交"
        exit 1
    fi

    echo "🧪 运行测试..."
    cargo test --quiet
    if [ $? -ne 0 ]; then
        echo "❌ 测试失败，请修复后再提交"
        exit 1
    fi

    echo "✅ 所有检查通过！"
fi
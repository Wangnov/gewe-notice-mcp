#!/bin/sh
# Git pre-commit hook - åœ¨æäº¤å‰è‡ªåŠ¨è¿è¡Œ Rust æ£€æŸ¥

echo "ğŸ” è¿è¡Œ pre-commit æ£€æŸ¥..."

# æ£€æŸ¥æ˜¯å¦æœ‰ Rust æ–‡ä»¶å˜æ›´
if git diff --cached --name-only | grep -q '\.rs$'; then
    echo "ğŸ“‹ æ£€æŸ¥ä»£ç æ ¼å¼..."
    cargo fmt --all -- --check
    if [ $? -ne 0 ]; then
        echo "âŒ ä»£ç æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¿è¡Œ 'cargo fmt' ä¿®å¤"
        exit 1
    fi

    echo "ğŸ” è¿è¡Œ Clippy..."
    cargo clippy --all-targets --all-features -- -D warnings
    if [ $? -ne 0 ]; then
        echo "âŒ Clippy å‘ç°äº†é—®é¢˜ï¼Œè¯·ä¿®å¤åå†æäº¤"
        exit 1
    fi

    echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
    cargo test --quiet
    if [ $? -ne 0 ]; then
        echo "âŒ æµ‹è¯•å¤±è´¥ï¼Œè¯·ä¿®å¤åå†æäº¤"
        exit 1
    fi

    echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼"
fi